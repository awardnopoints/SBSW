{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Bus App</title>

   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
      <link rel="stylesheet" type="text/css" href="{% static 'dbus/index.css' %}">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.0/css/bootstrap-datepicker3.standalone.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
     <!-- moment.js must be loaded first -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.js"></script>

<!-- bootstrap-datetimepicker -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      
  </head>


  <body>

    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <h1>Bus App</h1>
        </div>
          <ul class="nav navbar-nav navbar-right">
            <li class="active"><img src="/static/images/bus.png"> <img src="/static/images/ucd.png"><span class="sr-only">(current)</span></li>
          </ul>
        </div><!--/.nav-collapse -->
    </nav>        
      
    <div class="container">
      <div class="jumbotron text-center col-md-6">
        <form method = "POST" class = "post-form" id="post-form">{% csrf_token %}
          Route:<br>
            <select id="routes" >

            </select>

          <br>
          Start Stop:<br>
            <select id="start" disabled>  
                <option></option>
 
            </select><br>
          End Stop:<br>
            <select id="end" disabled>

            </select>
            <br>
          <button type = "submit" class = "save btn btn-default">Go</button>
        </form>
        <div id="results"><p> </p></div>
      </div> 
      <!-- Main component for a primary marketing message or call to action -->
      <div id='map' class="jumbotron text-center col-md-6"></div>
    </div> <!-- /container -->

    <script src="{% static 'dbus/markerclusterer.js' %}"></script>
    <script src="{% static 'dbus/jquery-3.3.1.min.js' %}"></script>
    <script type = "text/javascript">

      $(document).ready(function(){

        var stops = {};

        {% for stop in stops %}
          console.log('{{stop.stop_id}}')
        {% endfor %}
        

        $.get('/dbus/ajax_test/', {message: 'AJAX works!'}, function(data){
          console.log('success')
          $('#output').text(data);
        });
          
        $("#routes").change(function(){
          route=$("#routes option:selected").text();
          $.get('/bus_stops/', {route_number: route}, 
            function(key){
              console.log(typeof(key))
              key = JSON.parse(key)
              for (i=0; i<key.length; i++) {
                $('#start').append('<option>' + key[i] + '</option>')
                $('#start').prop('disabled', false)
              }
            }
          )
        }); 
          
        $("#start").change(function(){
            start=$("#start option:selected").text();
            $.get('/outbound/', {route_number: route, start_stop: start}, 
                  
                  function(key){
            
              $('#results > p').text(key)
        })});
          
      
            
          
        $('#post-form').on('submit', function(event){
          event.preventDefault();
          console.log("form submitted!");
          $('#results > p').text('waiting...');
          getPredictions()
        });
         
    
        function getPredictions(){
          routes=$("#routes option:selected").text();
          start_stop = $('input[name="start"]').val();
          end_stop = $('input[name="end"]').val();
          date = new Date();
          day = date.getDay();
          day = (day+6)%7; // Changing to Python values
          hour = date.getHours();
          console.log("Route =", routes)
          console.log("Start Stop =", start_stop)
          console.log("End Stop =", end_stop)
          console.log("Day =", day)
          console.log("Hour =", hour)
          $.get('/predict_request/', {route: routes, start_stop: start_stop, 
            end_stop: end_stop, day: day, 
            hour: hour}, function(data){
              $('#results > p').html("Estimated Journey Time:<br>" + data + " minutes");
          });
        };
      });
 
      function Go(){
          document.getElementById('results').innerHTML= " "
          var start_stop;
          var end_stop;
          GetStopID(start_stop, end_stop);
          
      }
          
          
          
          
      // 1. getRoutes - takes name of start bus stop and end bus stop and translates to bus stop number. 
      // Finds routes that pass through each bus stop and selects only those common to both. 
      // 2. Determines how many stops between start and end // returns routes and stops between each

      //next take time of day, day of week, weather and input into predictor?//
          
          
      function GetRoutes(start, end) {
        // GetPrediction(start, end, route);
          //match the start and end bus to start and end bus 
          //get routes
          //get stops between
      }
              
//      function GetPrediction(start, end, route) {
//          var dayInput = document.getElementById("exampleFormControlSelect1Day");
//          var day = selectTime.options[selectTime.selectedIndex].text;
//          var timeInput = document.getElementById("exampleFormControlSelect1Time");
//          var time = selectDay.options[selectDay.selectedIndex].text;
//          
//          if (day == " " || time == " ") {
//              var dt = new Date();
//              var time = dt.getHours() + ":" + dt.getMinutes();
//              //var day =
//                  
//              // new Date($.now());
//          //
//          }
//      }



      var map;
      var markers;
      function initMap(){
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 10,
        center: {lat: 53.3498, lng: -6.2603}
      });
      markers = [];
      }


    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADAq7_ArNs1g_fzNE-tLB0scnM5UtXXSM&callback=initMap" type = 'text/javascript'></script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>   
    
  </body>
</html>
